generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Admin {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   
  name      String
  createdAt          DateTime @default(now())
  failedLoginAttempts Int      @default(0)
  lockoutUntil       DateTime?
}

enum UserRole {
  CUSTOMER
  COMPANY
}

model User {
  id                String    @id @default(uuid())
  email             String    @unique
  password          String?   // Nullable for OAuth users who haven't set a password
  name              String
  role              UserRole  @default(CUSTOMER)
  
  // Company specific fields
  companyName       String?
  phoneNumber       String?
  country           String?
  
  gender            String?
  
  // OAuth fields
  googleId          String?   @unique
  avatar            String?

  // Password Reset
  resetToken        String?
  resetTokenExpiry  DateTime?
  
  // Lockout fields
  failedAttempts    Int       @default(0)
  lockoutUntil      DateTime?

  addresses         Address[]
  chatSessions      ChatSession[]
  orders            Order[]

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // OTP & Security
  otpCode           String?
  otpExpiry         DateTime?
  isVerified        Boolean   @default(false)
  lastLoginAt       DateTime?
}

model Address {
  id          String   @id @default(uuid())
  street      String
  city        String
  state       String
  postalCode  String
  country     String
  isDefault   Boolean  @default(false)
  userId      String
  user        User     @relation(fields: [userId], references: [id])
}

model ChatSession {
  id        String    @id @default(uuid())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  status    String    @default("OPEN") // OPEN, CLOSED, ARCHIVED
  userId    String?   
  user      User?     @relation(fields: [userId], references: [id])
  messages  Message[]
}

model Message {
  id            String      @id @default(uuid())
  createdAt     DateTime    @default(now())
  text          String
  sender        String      // "USER" or "AGENT"
  isBot         Boolean     @default(false)
  chatSessionId String
  chatSession   ChatSession @relation(fields: [chatSessionId], references: [id])
}

model Product {
  id          String      @id @default(uuid())
  name        String
  description String
  price       Float
  stock       Int
  image       String
  category    String      // "Gourmet", "Artisan", "Rich Brew"
  roast       String      // "Medium", "Dark"
  profile     String      // Flavor profile e.g. "Fruity, Floral"
  origin      String
  weight      String[]    // Array of available weights e.g. ["250g", "500g"]
  type        String      // "Beans", "Ground", "Both"
  status      String      // "In Stock", "Low Stock", "Out of Stock"
  additionalInfo String?  // Optional additional product information
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  orderItems  OrderItem[]
}

model Order {
  id          String      @id @default(uuid())
  total       Float
  status      String      // "Pending", "Processing", "Completed", "Cancelled"
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  userId      String?
  user        User?       @relation(fields: [userId], references: [id])
  items       OrderItem[]
}

model OrderItem {
  id        String  @id @default(uuid())
  quantity  Int
  price     Float
  orderId   String
  order     Order   @relation(fields: [orderId], references: [id])
  productId String
  product   Product @relation(fields: [productId], references: [id])
}

model BlogPost {
  id        String   @id @default(uuid())
  title     String
  date      DateTime @default(now())
  author    String
  image     String
  excerpt   String
  content   String
  tags      String[]
  category  String
  status    String   // "Published", "Draft"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
